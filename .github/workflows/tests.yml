name: Test Suite

on: pull_request

jobs:
  build-x86:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: read
    steps:
      - name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-region: us-west-2
          role-to-assume:  ${{ secrets.ACTIONS_ROLE }}

      - name: Checkout Code
        uses: actions/checkout@v3
        with: 
          submodules: true
          token: ${{ secrets.PAT_GITHUB }}

        
      - name: Update Java
        uses: actions/setup-java@v2
        with: 
          distribution: 'zulu' 
          java-version: '16'

      - uses: nttld/setup-ndk@v1.0.6
        id: setup-ndk
        with:
          ndk-version: r22b
          add-to-path: false
      - name: Installing pre-requisites
        run: |
          set -x
          # Install some dependencies & premake5
          sudo apt update && sudo apt-get -y install build-essential cmake wget clang g++ libgl1-mesa-dev libvorbis-dev libvpx-dev ninja-build
          wget https://github.com/premake/premake-core/releases/download/v5.0.0-alpha15/premake-5.0.0-alpha15-linux.tar.gz
          tar -xf premake-5.0.0-alpha15-linux.tar.gz
          mkdir bin
          cp premake5 bin/premake5
          sudo chmod a+x premake5
          sudo mv premake5 /usr/local/bin      
      - name: Build rive for x86
        run: |
          cd cpp && ./build.rive.for.sh -c -a x86 
        env:
          NDK_PATH: ${{ steps.setup-ndk.outputs.ndk-path }}

    # runs-on: macos-latest
    # steps:
    #   - name: Checkout Code
    #     uses: actions/checkout@v2
        
    #   - name: Update Java
    #     uses: actions/setup-java@v2
    #     with: 
    #       distribution: 'zulu' 
    #       java-version: '16'
      
    #   - name: Build all 
    #     run: |
    #       cd cpp && ./build.all.sh

    #   - name: Test Android v30
    #     uses: reactivecircus/android-emulator-runner@v2
    #     with:
    #       api-level: 30
    #       target: google_apis
    #       script: ./gradlew kotlin:connectedAndroidTest
